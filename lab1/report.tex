\documentclass[12pt]{article}
\usepackage{{booktabs}}
\usepackage{float}
\usepackage{listings}
\usepackage{subcaption}
\usepackage{adjustbox}

\lstset{%
  breaklines=true,
  breakatwhitespace=true,
}

\title{%
    CSE5449 Lab 1 \\
    \large  Running and benchmarking communication \\
    primitives (OMB and OMB-Py)}
\author{Salil Reddy}
\date{Autumn '23}
\begin{document}
\maketitle

\begin{enumerate}
    \item Allocate 2 nodes and run OSU Micro-Benchmarks (OMB) on Owens.
        \begin{enumerate}
            \item Run point-to-point communication benchmarks on CPU and GPU 
                    with max message size of 64 MB 
                \begin{enumerate}
                    \item osu\_latency
                    \item osu\_bw
                    \item osu\_bibw
                \end{enumerate}
            \item Run collective communication benchmarks on CPU and GPU with 
                max message size of 64 MB 
                \begin{enumerate}
                    \item osu\_allreduce
                    \item osu\_reduce
                \end{enumerate}
        \end{enumerate}

    \paragraph[short]{Solution} OMB benchmark results for GPU and CPU:
    
    \begin{verbatim}
    # osu_latency
    # GPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/pt2pt/osu_latency 
    -m 67108864 D D

    # CPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/pt2pt/osu_latency 
    -m 67108864 H H 

    # osu_bw
    # GPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/pt2pt/osu_bw 
    -m 67108864 D D

    # CPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/pt2pt/osu_bw
    -m 67108864 H H

    # osu_bibw
    # GPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1,
    MV2_CUDA_BLOCK_SIZE=8388608  
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/pt2pt/osu_bibw 
    -m 67108864 D D

    # CPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1,
    MV2_CUDA_BLOCK_SIZE=8388608  
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/pt2pt/osu_bibw 
    -m 67108864 H H

    # osu_allreduce
    # GPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/collective/osu_allreduce 
    -d cuda -m 67108864

    # CPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/collective/osu_allreduce 
    -m 67108864

    # osu_reduce
    # GPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/collective/osu_reduce 
    -d cuda -m 67108864

    # CPU
    srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
    installed/libexec/osu-micro-benchmarks/get_local_rank 
    installed/libexec/osu-micro-benchmarks/mpi/collective/osu_reduce 
    -m 67108864
    \end{verbatim}

    \newpage

    \begin{enumerate}
        \item Point-to-Point OMB Results (latency, bw, bibw)\\
        \\
        \begin{tabular}[h]{ cc }
            osu\_latency GPU-GPU & osu\_latency CPU-CPU \\
            \begin{tabular}{rr}
                \toprule
                Size & Latency(us) \\
                \midrule
                0 & 1.43 \\
                1 & 5.22 \\
                2 & 5.14 \\
                4 & 5.21 \\
                8 & 5.16 \\
                16 & 5.01 \\
                32 & 5.11 \\
                64 & 5.10 \\
                128 & 5.38 \\
                256 & 5.74 \\
                512 & 6.94 \\
                1024 & 9.32 \\
                2048 & 13.67 \\
                4096 & 21.99 \\
                8192 & 24.21 \\
                16384 & 27.40 \\
                32768 & 28.95 \\
                65536 & 38.36 \\
                131072 & 56.64 \\
                262144 & 91.59 \\
                524288 & 157.77 \\
                1048576 & 204.67 \\
                2097152 & 296.50 \\
                4194304 & 480.37 \\
                8388608 & 848.75 \\
                16777216 & 1618.31 \\
                33554432 & 3170.73 \\
                67108864 & 6299.39 \\
                \bottomrule
            \end{tabular} &
            \begin{tabular}{rr}
                \toprule
                Size & Latency(us) \\
                \midrule
                0 & 1.40 \\
                1 & 1.48 \\
                2 & 1.49 \\
                4 & 1.41 \\
                8 & 1.45 \\
                16 & 1.45 \\
                32 & 1.45 \\
                64 & 1.50 \\
                128 & 1.54 \\
                256 & 2.32 \\
                512 & 2.34 \\
                1024 & 2.55 \\
                2048 & 2.97 \\
                4096 & 5.45 \\
                8192 & 6.98 \\
                16384 & 8.09 \\
                32768 & 9.55 \\
                65536 & 13.55 \\
                131072 & 21.62 \\
                262144 & 34.73 \\
                524288 & 60.36 \\
                1048576 & 103.24 \\
                2097152 & 191.72 \\
                4194304 & 369.38 \\
                8388608 & 719.07 \\
                16777216 & 1410.29 \\
                33554432 & 2794.81 \\
                67108864 & 5575.05 \\
                \bottomrule
            \end{tabular} \\
        \end{tabular} \\

        \begin{tabular}[h]{ cc }
            osu\_bw GPU-GPU & osu\_bw CPU-CPU \\
            \begin{tabular}{rr}
                \toprule
                Size & Bandwidth(MB/s) \\
                \midrule
                1 & 0.50 \\
                2 & 1.05 \\
                4 & 2.31 \\
                8 & 5.62 \\
                16 & 11.07 \\
                32 & 22.19 \\
                64 & 44.66 \\
                128 & 87.95 \\
                256 & 160.89 \\
                512 & 236.52 \\
                1024 & 252.40 \\
                2048 & 273.28 \\
                4096 & 288.58 \\
                8192 & 1337.67 \\
                16384 & 2561.99 \\
                32768 & 4419.48 \\
                65536 & 6296.08 \\
                131072 & 7869.99 \\
                262144 & 9074.80 \\
                524288 & 10289.52 \\
                1048576 & 10686.91 \\
                2097152 & 10978.69 \\
                4194304 & 10322.93 \\
                8388608 & 9300.61 \\
                16777216 & 8544.62 \\
                33554432 & 7252.21 \\
                67108864 & 7954.47 \\
                \bottomrule
            \end{tabular} &
            \begin{tabular}{rr}
                \toprule
                Size & Bandwidth(MB/s) \\
                \midrule
                1 & 1.65 \\
                2 & 3.29 \\
                4 & 6.83 \\
                8 & 13.45 \\
                16 & 26.84 \\
                32 & 55.21 \\
                64 & 109.26 \\
                128 & 211.34 \\
                256 & 414.67 \\
                512 & 810.37 \\
                1024 & 1395.67 \\
                2048 & 2326.12 \\
                4096 & 3675.21 \\
                8192 & 4959.90 \\
                16384 & 9162.60 \\
                32768 & 10730.21 \\
                65536 & 11285.36 \\
                131072 & 11654.89 \\
                262144 & 11873.07 \\
                524288 & 11972.41 \\
                1048576 & 12017.19 \\
                2097152 & 12041.01 \\
                4194304 & 12055.67 \\
                8388608 & 12055.63 \\
                16777216 & 12064.29 \\
                33554432 & 12066.45 \\
                67108864 & 12070.69 \\
                \bottomrule
            \end{tabular} \\
        \end{tabular} \\

        \begin{tabular}[h]{ cc }
            osu\_bibw GPU-GPU & osu\_bibw CPU-CPU \\
            \begin{tabular}{rr}
                \toprule
                Size & Bandwidth(MB/s) \\
                \midrule
                1 & 0.26 \\
                2 & 1.66 \\
                4 & 2.63 \\
                8 & 6.76 \\
                16 & 10.55 \\
                32 & 20.58 \\
                64 & 45.73 \\
                128 & 81.78 \\
                256 & 174.81 \\
                512 & 268.11 \\
                1024 & 359.88 \\
                2048 & 351.62 \\
                4096 & 499.61 \\
                8192 & 722.14 \\
                16384 & 2632.69 \\
                32768 & 4656.36 \\
                65536 & 1828.30 \\
                131072 & 3311.78 \\
                262144 & 14843.53 \\
                524288 & 17565.73 \\
                1048576 & 20112.25 \\
                2097152 & 19919.36 \\
                4194304 & 20897.50 \\
                8388608 & 21355.88 \\
                16777216 & 19225.16 \\
                33554432 & 19711.09 \\
                67108864 & 19915.18 \\
                \bottomrule
            \end{tabular} &
            \begin{tabular}{rr}
                \toprule
                Size & Bandwidth(MB/s) \\
                \midrule
                1 & 0.26 \\
                2 & 3.27 \\
                4 & 6.91 \\
                8 & 15.73 \\
                16 & 31.27 \\
                32 & 60.45 \\
                64 & 109.66 \\
                128 & 216.49 \\
                256 & 410.84 \\
                512 & 805.76 \\
                1024 & 1436.59 \\
                2048 & 2570.27 \\
                4096 & 3470.57 \\
                8192 & 5075.94 \\
                16384 & 9754.47 \\
                32768 & 16365.59 \\
                65536 & 21359.46 \\
                131072 & 21448.33 \\
                262144 & 20515.82 \\
                524288 & 21327.01 \\
                1048576 & 22149.69 \\
                2097152 & 23643.33 \\
                4194304 & 23435.29 \\
                8388608 & 23116.46 \\
                16777216 & 23171.79 \\
                33554432 & 23160.73 \\
                67108864 & 23158.28 \\
                \bottomrule
            \end{tabular} \\
        \end{tabular} \\

        \newpage

        \item Collective OMB Results (allreduce, reduce) \\
        \\
        \begin{tabular}[h]{ cc }
            osu\_allreduce GPU-GPU & osu\_allreduce CPU-CPU \\
            \begin{tabular}{rr}
                \toprule
                Size & AvgLatency(us) \\
                \midrule
                4 & 13.46 \\
                8 & 13.18 \\
                16 & 12.68 \\
                32 & 12.17 \\
                64 & 11.51 \\
                128 & 11.64 \\
                256 & 12.36 \\
                512 & 13.72 \\
                1024 & 17.20 \\
                2048 & 23.16 \\
                4096 & 39.84 \\
                8192 & 63.03 \\
                16384 & 90.49 \\
                32768 & 50.97 \\
                65536 & 59.82 \\
                131072 & 79.08 \\
                262144 & 114.17 \\
                524288 & 208.64 \\
                1048576 & 231.35 \\
                2097152 & 354.91 \\
                4194304 & 623.27 \\
                8388608 & 1187.99 \\
                16777216 & 2236.87 \\
                33554432 & 4288.70 \\
                67108864 & 8310.03 \\
                \bottomrule
            \end{tabular} &
            \begin{tabular}{rr}
                \toprule
                Size & AvgLatency(us) \\
                \midrule
                4 & 2.34 \\
                8 & 2.03 \\
                16 & 2.02 \\
                32 & 2.06 \\
                64 & 2.46 \\
                128 & 2.54 \\
                256 & 2.68 \\
                512 & 2.79 \\
                1024 & 3.10 \\
                2048 & 3.58 \\
                4096 & 8.36 \\
                8192 & 10.02 \\
                16384 & 15.35 \\
                32768 & 30.42 \\
                65536 & 47.58 \\
                131072 & 76.09 \\
                262144 & 115.18 \\
                524288 & 132.33 \\
                1048576 & 248.22 \\
                2097152 & 465.73 \\
                4194304 & 888.56 \\
                8388608 & 1880.25 \\
                16777216 & 3147.58 \\
                33554432 & 6175.65 \\
                67108864 & 13328.55 \\
                \bottomrule
            \end{tabular} \\
        \end{tabular} \\

        \begin{tabular}[h]{ cc }
            osu\_reduce GPU-GPU & osu\_reduce CPU-CPU \\
            \begin{tabular}{rr}
                \toprule
                Size & AvgLatency(us) \\
                \midrule
                4 & 10.10 \\
                8 & 9.88 \\
                16 & 9.70 \\
                32 & 9.31 \\
                64 & 8.69 \\
                128 & 8.76 \\
                256 & 9.48 \\
                512 & 10.36 \\
                1024 & 23.69 \\
                2048 & 16.52 \\
                4096 & 25.20 \\
                8192 & 39.52 \\
                16384 & 40.29 \\
                32768 & 58.60 \\
                65536 & 85.63 \\
                131072 & 145.39 \\
                262144 & 260.85 \\
                524288 & 152.62 \\
                1048576 & 197.98 \\
                2097152 & 303.60 \\
                4194304 & 501.22 \\
                8388608 & 897.10 \\
                16777216 & 1667.91 \\
                33554432 & 3175.07 \\
                67108864 & 6191.04 \\
                \bottomrule
            \end{tabular} &
            \begin{tabular}{rr}
                \toprule
                Size & AvgLatency(us) \\
                \midrule
                4 & 1.47 \\
                8 & 1.45 \\
                16 & 1.41 \\
                32 & 1.34 \\
                64 & 1.37 \\
                128 & 1.42 \\
                256 & 1.70 \\
                512 & 1.80 \\
                1024 & 1.99 \\
                2048 & 2.41 \\
                4096 & 2.96 \\
                8192 & 3.84 \\
                16384 & 18.74 \\
                32768 & 15.58 \\
                65536 & 26.17 \\
                131072 & 46.02 \\
                262144 & 80.98 \\
                524288 & 151.82 \\
                1048576 & 265.23 \\
                2097152 & 496.82 \\
                4194304 & 889.07 \\
                8388608 & 1862.31 \\
                16777216 & 3306.15 \\
                33554432 & 6996.56 \\
                67108864 & 13536.17 \\
                \bottomrule
            \end{tabular} \\
        \end{tabular} \\

    \end{itemize}
    
    \item Allocate 2 nodes and run OSU Micro-Benchmarks for Python 
            (OMB-Py) on Owens. 
        \begin{enumerate}
            \item Run point-to-point communication benchmarks on numpy, numba, 
                    and cupy buffers with max message size of 64MB  
                \begin{enumerate}
                    \item osu\_latency
                    \item osu\_bw
                    \item osu\_bibw
                \end{enumerate}
            \item Run collective communication benchmarks on numpy, numba, and 
                    cupy buffers with max message size of 64MB 
                \begin{enumerate}
                    \item osu\_allreduce
                    \item osu\_reduce
                \end{enumerate}
        \end{enumerate}

    \paragraph[short]{Solution} OMB-Py benchmark results:

    \begin{verbatim}
        # osu_latency
        # numpy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark latency --buffer numpy --max 67108864
    
        # numba
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark latency --buffer numba --max 67108864

        # cupy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark latency --buffer cupy --max 67108864

        # osu_bw
        # numpy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark bw --buffer numpy --max 67108864
    
        # numba
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark bw --buffer numba --max 67108864

        # cupy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark bw --buffer cupy --max 67108864
    
        # osu_bibw
        # numpy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1,
        MV2_CUDA_BLOCK_SIZE=8388608  python run.py --benchmark bibw 
        --buffer numpy --max 67108864
    
        # numba
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1,
        MV2_CUDA_BLOCK_SIZE=8388608  python run.py --benchmark bibw 
        --buffer numba --max 67108864

        # cupy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1,
        MV2_CUDA_BLOCK_SIZE=8388608  python run.py --benchmark bibw 
        --buffer cupy --max 67108864
    
        # osu_allreduce
        # numpy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark allreduce --buffer numpy --max 67108864
    
        # numba
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark allreduce --buffer numba --max 67108864

        # cupy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark allreduce --buffer cupy --max 67108864
    
        # osu_reduce
        # numpy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark reduce --buffer numpy --max 67108864
    
        # numba
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark reduce --buffer numba --max 67108864

        # cupy
        srun -n 2 --export=ALL,MV2_USE_CUDA=1,MV2_SUPPORT_DL=1 
        python run.py --benchmark reduce --buffer cupy --max 67108864
        \end{verbatim}

    \begin{enumerate}
        \item Point-to-point OMB-Py results (latency, bw, bibw)
        \item Collective OMB-Py results (allreduce, reduce)
    \end{enumerate}

    \begin{table}[H]
        \centering
        \begin{subtable}{.3\textwidth}
            \centering
            \caption{osu\_latency}
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Latency(us) \\
                    \midrule
                    0 & 2.36 \\
                    1 & 2.28 \\
                    2 & 1.87 \\
                    4 & 1.86 \\
                    8 & 1.86 \\
                    16 & 1.90 \\
                    32 & 1.94 \\
                    64 & 1.97 \\
                    128 & 2.02 \\
                    256 & 2.59 \\
                    512 & 2.71 \\
                    1024 & 2.94 \\
                    2048 & 3.27 \\
                    4096 & 5.72 \\
                    8192 & 7.15 \\
                    16384 & 8.07 \\
                    32768 & 9.57 \\
                    65536 & 13.81 \\
                    131072 & 21.34 \\
                    262144 & 35.72 \\
                    524288 & 62.24 \\
                    1048576 & 103.44 \\
                    2097152 & 193.42 \\
                    4194304 & 367.03 \\
                    8388608 & 726.19 \\
                    16777216 & 1434.74 \\
                    33554432 & 2849.56 \\
                    67108864 & 5681.03 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numpy}
            \label{table1}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Latency(us) \\
                    \midrule
                    0 & 7.45 \\
                    1 & 12.51 \\
                    2 & 12.55 \\
                    4 & 12.59 \\
                    8 & 12.45 \\
                    16 & 12.41 \\
                    32 & 12.36 \\
                    64 & 12.30 \\
                    128 & 12.54 \\
                    256 & 13.04 \\
                    512 & 14.27 \\
                    1024 & 16.75 \\
                    2048 & 21.15 \\
                    4096 & 29.77 \\
                    8192 & 36.10 \\
                    16384 & 39.58 \\
                    32768 & 41.11 \\
                    65536 & 49.96 \\
                    131072 & 68.54 \\
                    262144 & 102.56 \\
                    524288 & 166.99 \\
                    1048576 & 216.52 \\
                    2097152 & 308.13 \\
                    4194304 & 493.86 \\
                    8388608 & 860.00 \\
                    16777216 & 1628.45 \\
                    33554432 & 3182.76 \\
                    67108864 & 6324.15 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numba}
            \label{table2}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Latency(us) \\
                    \midrule
                    0 & 5.51 \\
                    1 & 10.13 \\
                    2 & 9.80 \\
                    4 & 9.99 \\
                    8 & 9.98 \\
                    16 & 9.70 \\
                    32 & 9.70 \\
                    64 & 9.87 \\
                    128 & 9.74 \\
                    256 & 10.29 \\
                    512 & 11.42 \\
                    1024 & 13.93 \\
                    2048 & 18.27 \\
                    4096 & 26.96 \\
                    8192 & 32.95 \\
                    16384 & 36.01 \\
                    32768 & 37.98 \\
                    65536 & 46.72 \\
                    131072 & 65.55 \\
                    262144 & 99.59 \\
                    524288 & 166.67 \\
                    1048576 & 212.99 \\
                    2097152 & 304.33 \\
                    4194304 & 490.59 \\
                    8388608 & 857.15 \\
                    16777216 & 1628.51 \\
                    33554432 & 3184.42 \\
                    67108864 & 6336.09 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{cupy}
            \label{table3}
        \end{subtable}
    \end{table}

    \begin{table}[H]
        \centering
        \begin{subtable}{.3\textwidth}
            \centering
            \caption{osu\_bw}
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Bandwidth(MB/s) \\
                    \midrule
                    1 & 0.63 \\
                    2 & 1.32 \\
                    4 & 2.75 \\
                    8 & 5.67 \\
                    16 & 11.70 \\
                    32 & 24.12 \\
                    64 & 54.29 \\
                    128 & 121.74 \\
                    256 & 226.28 \\
                    512 & 440.03 \\
                    1024 & 794.79 \\
                    2048 & 1445.47 \\
                    4096 & 2386.61 \\
                    8192 & 3330.89 \\
                    16384 & 5672.95 \\
                    32768 & 8752.04 \\
                    65536 & 10064.37 \\
                    131072 & 10936.11 \\
                    262144 & 11271.26 \\
                    524288 & 11559.71 \\
                    1048576 & 11615.33 \\
                    2097152 & 11703.34 \\
                    4194304 & 11754.15 \\
                    8388608 & 11767.55 \\
                    16777216 & 11797.33 \\
                    33554432 & 11733.19 \\
                    67108864 & 11727.18 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numpy}
            \label{table4}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Bandwidth(MB/s) \\
                    \midrule
                    1 & 0.13 \\
                    2 & 0.26 \\
                    4 & 0.52 \\
                    8 & 1.05 \\
                    16 & 1.97 \\
                    32 & 4.02 \\
                    64 & 8.11 \\
                    128 & 15.79 \\
                    256 & 31.10 \\
                    512 & 59.83 \\
                    1024 & 100.85 \\
                    2048 & 151.85 \\
                    4096 & 202.80 \\
                    8192 & 539.14 \\
                    16384 & 1015.51 \\
                    32768 & 1970.75 \\
                    65536 & 3261.74 \\
                    131072 & 5367.89 \\
                    262144 & 7484.68 \\
                    524288 & 9145.01 \\
                    1048576 & 10103.54 \\
                    2097152 & 10560.66 \\
                    4194304 & 10462.30 \\
                    8388608 & 7840.14 \\
                    16777216 & 6742.80 \\
                    33554432 & 6371.37 \\
                    67108864 & 7911.43 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numba}
            \label{table5}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Bandwidth(MB/s) \\
                    \midrule
                    1 & 0.21 \\
                    2 & 0.41 \\
                    4 & 0.83 \\
                    8 & 1.68 \\
                    16 & 3.36 \\
                    32 & 6.68 \\
                    64 & 13.41 \\
                    128 & 26.83 \\
                    256 & 52.06 \\
                    512 & 94.79 \\
                    1024 & 135.72 \\
                    2048 & 195.64 \\
                    4096 & 237.36 \\
                    8192 & 633.23 \\
                    16384 & 1215.22 \\
                    32768 & 2256.53 \\
                    65536 & 3927.67 \\
                    131072 & 6074.58 \\
                    262144 & 8279.94 \\
                    524288 & 9621.28 \\
                    1048576 & 10479.95 \\
                    2097152 & 10690.83 \\
                    4194304 & 10552.25 \\
                    8388608 & 7990.01 \\
                    16777216 & 7052.06 \\
                    33554432 & 6602.39 \\
                    67108864 & 7931.80 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{cupy}
            \label{table6}
        \end{subtable}
    \end{table}

    \begin{table}[H]
        \centering
        \begin{subtable}{.3\textwidth}
            \centering
            \caption{osu\_bibw}
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Bandwidth(MB/s) \\
                    \midrule
                    1 & 0.24 \\
                    2 & 1.72 \\
                    4 & 3.42 \\
                    8 & 6.81 \\
                    16 & 13.65 \\
                    32 & 26.32 \\
                    64 & 51.51 \\
                    128 & 101.28 \\
                    256 & 202.22 \\
                    512 & 400.91 \\
                    1024 & 756.16 \\
                    2048 & 1431.51 \\
                    4096 & 1957.00 \\
                    8192 & 3239.50 \\
                    16384 & 6745.99 \\
                    32768 & 11616.09 \\
                    65536 & 17358.43 \\
                    131072 & 17963.28 \\
                    262144 & 22456.32 \\
                    524288 & 23038.92 \\
                    1048576 & 23285.10 \\
                    2097152 & 23301.26 \\
                    4194304 & 23212.75 \\
                    8388608 & 23096.95 \\
                    16777216 & 23038.53 \\
                    33554432 & 22987.19 \\
                    67108864 & 23077.95 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numpy}
            \label{table7}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Bandwidth(MB/s) \\
                    \midrule
                    1 & 0.10 \\
                    2 & 0.24 \\
                    4 & 0.50 \\
                    8 & 1.10 \\
                    16 & 2.28 \\
                    32 & 4.57 \\
                    64 & 9.17 \\
                    128 & 18.28 \\
                    256 & 36.00 \\
                    512 & 70.83 \\
                    1024 & 126.99 \\
                    2048 & 207.94 \\
                    4096 & 358.11 \\
                    8192 & 663.57 \\
                    16384 & 1277.25 \\
                    32768 & 2573.37 \\
                    65536 & 4790.18 \\
                    131072 & 3614.50 \\
                    262144 & 12378.19 \\
                    524288 & 16141.50 \\
                    1048576 & 18785.06 \\
                    2097152 & 18938.40 \\
                    4194304 & 20280.68 \\
                    8388608 & 21078.33 \\
                    16777216 & 21173.28 \\
                    33554432 & 21003.97 \\
                    67108864 & 21127.25 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numba}
            \label{table8}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Bandwidth(MB/s) \\
                    \midrule
                    1 & 0.13 \\
                    2 & 0.34 \\
                    4 & 0.68 \\
                    8 & 1.37 \\
                    16 & 2.95 \\
                    32 & 6.30 \\
                    64 & 12.60 \\
                    128 & 25.18 \\
                    256 & 49.73 \\
                    512 & 97.40 \\
                    1024 & 167.53 \\
                    2048 & 262.20 \\
                    4096 & 412.35 \\
                    8192 & 759.04 \\
                    16384 & 1476.62 \\
                    32768 & 3060.24 \\
                    65536 & 5577.06 \\
                    131072 & 9294.10 \\
                    262144 & 4395.88 \\
                    524288 & 10314.76 \\
                    1048576 & 19312.68 \\
                    2097152 & 19129.52 \\
                    4194304 & 20387.27 \\
                    8388608 & 21149.46 \\
                    16777216 & 21032.19 \\
                    33554432 & 20963.53 \\
                    67108864 & 21099.26 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{cupy}
            \label{table9}
        \end{subtable}
    \end{table}

    \begin{table}[H]
        \centering
        \begin{subtable}{.3\textwidth}
            \centering
            \caption{osu\_allreduce}
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Latency(us) \\
                    \midrule
                    4 & 2.90 \\
                    8 & 2.90 \\
                    16 & 2.93 \\
                    32 & 2.96 \\
                    64 & 3.01 \\
                    128 & 3.14 \\
                    256 & 3.72 \\
                    512 & 3.93 \\
                    1024 & 4.26 \\
                    2048 & 4.88 \\
                    4096 & 9.90 \\
                    8192 & 11.89 \\
                    16384 & 19.55 \\
                    32768 & 35.53 \\
                    65536 & 53.43 \\
                    131072 & 78.95 \\
                    262144 & 124.85 \\
                    524288 & 142.00 \\
                    1048576 & 269.68 \\
                    2097152 & 520.21 \\
                    4194304 & 1046.84 \\
                    8388608 & 2017.70 \\
                    16777216 & 4019.73 \\
                    33554432 & 7491.97 \\
                    67108864 & 16128.64 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numpy}
            \label{table10}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Latency(us) \\
                    \midrule
                    4 & 24.99 \\
                    8 & 25.28 \\
                    16 & 25.16 \\
                    32 & 25.12 \\
                    64 & 25.48 \\
                    128 & 25.88 \\
                    256 & 26.76 \\
                    512 & 28.30 \\
                    1024 & 31.92 \\
                    2048 & 38.02 \\
                    4096 & 57.19 \\
                    8192 & 80.22 \\
                    16384 & 113.92 \\
                    32768 & 73.85 \\
                    65536 & 82.27 \\
                    131072 & 101.54 \\
                    262144 & 136.64 \\
                    524288 & 230.64 \\
                    1048576 & 254.87 \\
                    2097152 & 374.30 \\
                    4194304 & 626.98 \\
                    8388608 & 1231.85 \\
                    16777216 & 2256.49 \\
                    33554432 & 4284.99 \\
                    67108864 & 8233.69 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numba}
            \label{table11}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Latency(us) \\
                    \midrule
                    4 & 19.33 \\
                    8 & 19.51 \\
                    16 & 19.56 \\
                    32 & 19.72 \\
                    64 & 19.78 \\
                    128 & 20.23 \\
                    256 & 21.45 \\
                    512 & 23.17 \\
                    1024 & 27.23 \\
                    2048 & 33.33 \\
                    4096 & 51.00 \\
                    8192 & 74.60 \\
                    16384 & 106.06 \\
                    32768 & 69.05 \\
                    65536 & 76.78 \\
                    131072 & 96.37 \\
                    262144 & 131.21 \\
                    524288 & 225.96 \\
                    1048576 & 250.01 \\
                    2097152 & 369.21 \\
                    4194304 & 626.33 \\
                    8388608 & 1224.08 \\
                    16777216 & 2254.23 \\
                    33554432 & 4282.43 \\
                    67108864 & 8217.09 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{cupy}
            \label{table12}
        \end{subtable}
    \end{table}

    \begin{table}[H]
        \centering
        \begin{subtable}{.3\textwidth}
            \centering
            \caption{osu\_reduce}
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Latency(us) \\
                    \midrule
                    4 & 2.23 \\
                    8 & 2.02 \\
                    16 & 1.85 \\
                    32 & 1.35 \\
                    64 & 1.35 \\
                    128 & 1.36 \\
                    256 & 1.40 \\
                    512 & 1.52 \\
                    1024 & 1.78 \\
                    2048 & 2.29 \\
                    4096 & 2.75 \\
                    8192 & 3.86 \\
                    16384 & 21.28 \\
                    32768 & 17.55 \\
                    65536 & 32.00 \\
                    131072 & 57.48 \\
                    262144 & 99.43 \\
                    524288 & 182.27 \\
                    1048576 & 249.98 \\
                    2097152 & 474.56 \\
                    4194304 & 940.68 \\
                    8388608 & 1968.03 \\
                    16777216 & 3858.75 \\
                    33554432 & 7605.43 \\
                    67108864 & 13169.93 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numpy}
            \label{table13}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Latency(us) \\
                    \midrule
                    4 & 20.43 \\
                    8 & 20.27 \\
                    16 & 20.24 \\
                    32 & 20.36 \\
                    64 & 20.29 \\
                    128 & 20.77 \\
                    256 & 21.42 \\
                    512 & 22.86 \\
                    1024 & 720.84 \\
                    2048 & 35.90 \\
                    4096 & 64.11 \\
                    8192 & 72.11 \\
                    16384 & 101.05 \\
                    32768 & 119.14 \\
                    65536 & 152.16 \\
                    131072 & 221.38 \\
                    262144 & 375.19 \\
                    524288 & 326.19 \\
                    1048576 & 368.16 \\
                    2097152 & 462.39 \\
                    4194304 & 681.60 \\
                    8388608 & 1249.99 \\
                    16777216 & 2244.47 \\
                    33554432 & 4261.50 \\
                    67108864 & 8337.65 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{numba}
            \label{table14}
        \end{subtable}
        \begin{subtable}{.3\textwidth}
            \centering
            \adjustbox{width=\textwidth}{
                \begin{tabular}{rr}
                    \toprule
                    Size(B) & Latency(us) \\
                    \midrule
                    4 & 16.07 \\
                    8 & 16.20 \\
                    16 & 16.21 \\
                    32 & 16.35 \\
                    64 & 16.24 \\
                    128 & 16.58 \\
                    256 & 17.60 \\
                    512 & 18.99 \\
                    1024 & 728.29 \\
                    2048 & 33.62 \\
                    4096 & 61.88 \\
                    8192 & 69.15 \\
                    16384 & 97.01 \\
                    32768 & 117.43 \\
                    65536 & 150.97 \\
                    131072 & 217.19 \\
                    262144 & 373.43 \\
                    524288 & 319.56 \\
                    1048576 & 363.47 \\
                    2097152 & 456.49 \\
                    4194304 & 679.89 \\
                    8388608 & 1238.79 \\
                    16777216 & 2246.87 \\
                    33554432 & 4235.82 \\
                    67108864 & 8311.08 \\
                    \bottomrule
                    \end{tabular}
            }
            \caption{cupy}
            \label{table15}
        \end{subtable}
    \end{table}
    
    \item Compare the performance of OMB point-to-point and collective 
            benchmarks on CPU with GPU. Explain the reasons for the trends 
            you observe.

    \paragraph[short]{Solution} 
    
    \begin{itemize}
        \item OMB point-to-point benchmarks show CPU-CPU communication 
            having a lower latency and higher bandwidth than GPU-GPU. This could be 
            because in a point-to-point scenario, the GPU-GPU communication has the 
            added overhead of data being moved from the CPU to GPU each time.
        \item Similarly CPU-CPU has higer bandwidth, with bandwidth increasing with message size 
            but in the case of GPU-GPU we see bandwidth for some smaller message sizes degrading. This could 
            be due to the overhead of frequent data copies from the CPU to GPU in the case of smaller messages.
        \item In the case of collective communication (allreduce and reduce) we see much lower 
            latencies for GPU-GPU, where the GPUs higher bandwidth is better utilized due to data parallelism.
    \end{itemize}

    \item Compare the performance of OMB-Py point-to-point and collective 
            benchmarks for numpy, numba, and cupy. Describe if you find any 
            interesting trend
    
    \paragraph[short]{Solution} 

    \begin{itemize}
        \item Similar to the OMB results, the point-to-point communications favor numpy buffers
        as they leverage the CPU, while numba and cupy are GPU-based.
        \item Numba and CuPy exhibit similar performance with CuPy being slightly better than numba for GPUs
        \item Numba and CuPy buffers in the p2p bandwidth benchmarks show a similar trend where 
            BW degrades for message size greater than 4 MiB. Since they both exhibit, it might be 
            due to the memory limitation of the GPU, although that same trend is not 
            seen in the bidirectional bandwidth benchmark.
        \item Similar to the OMB results, in the case of collective communications, the numpy buffers 
        have much higher latencies than numba and cupy, due to being limited to the CPU
    \end{itemize}

    \item Compare the performance of OMB and OMB-Py. Explain the reasons 
            for the trends you observe.

    \paragraph[short]{Solution}

    \begin{itemize}
        \item Point-to-point communications show slight higher latencies for OMB-Py, especially for GPU buffers and 
            when message size is small (smaller than 1 MiB)
        \item For larger message sizes (greater than 4 MiB), there is a smaller delta in latencies when comparing OMB GPU-GPU and 
            OMB-Py GPU (numba, CuPy) buffers
        \item Similar hit to bandwidth in p2p communications at message sizes greater than 4 MiB, thus showing it's not a benchmark artefact
        \item Similarly lower bandwidth (compared to latency) in OMB-Py for smaller message sizes compared to OMB GPU-GPU
        \item OMB-Py adds a small overhead compared to OMB. OMB-Py uses the MPI4Py wrapper whereas OMB uses a native MPI library.
    \end{itemize}

    \item Compare the performance of the allreduce and reduce operations for 
            both OMB and OMB-Py in terms of latency. Explain the reasons for the 
            trends you observe.
    
    \paragraph[short]{Solution} The higher latencies and bandwidth overhead of OMB-Py in collective comms is similar to those observed in 
    p2p case. The latencies increase with message size. Due to difference being in the runtime (python vs. C), the python code which 
    generates message frames and the remaining CPU-bound code might be the reason for this overhead.

\end{itemize}

\end{document}